{
  "name": "Repeating Survey Portal",

  "namespace":"Stanford\\RepeatingSurveyPortal",

  "description": "Provides a survey portal for repeat surveys with many options",

  "versions": [
    { "0.1": "Initial" }
  ],

  "authors": [
    {
      "name": "Andrew Martin",
      "email": "andy123@stanford.edu",
      "institution": "Stanford University"
    },
    {
      "name": "Jae Lee",
      "email": "jael@stanford.edu",
      "institution": "Stanford University"
    }
  ],

  "permissions": [
    "redcap_save_record",
    "redcap_survey_complete",
    "redcap_module_system_enable",
    "redcap_module_link_check_display",
    "redcap_module_save_configuration"
  ],

  "enable-every-page-hooks-on-system-pages": true,

  "no-auth-pages": [
  ],

  "links": {
    "control-center": [

    ],
    "project": [
      {
        "name": "RSP: Test Cron Links",
        "icon": "gear",
        "url": "web/DisplayCronLinks.php"
      },
      {
        "name": "RSP: Survey Schedule Report",
        "icon": "gear",
        "url": "web/forecast.php"
      }
    ]
  },

  "no-auth-pages": [
    "web/landing",
    "web/InviteCron",
    "web/ReminderCron",
    "web/incoming"
  ],

  "system-settings": [
    {
      "key": "enable-system-debug-logging",
      "name": "<b>Enable Debug Logging</b><br>If you have the Stanford emLogger external module installed and configured, you can enable additional debug-level logging through this checkbox</b>",
      "required": false,
      "type": "checkbox"
    }
  ],

  "project-settings": [
    {
      "key": "enable-project-debug-logging",
      "name": "<b>Enable Debug Logging</b>",
      "required": false,
      "type": "checkbox"
    },
    {
      "key": "main-config-event-name",
      "name": "<b>Main Config Event Name</b><br>Name of event where fields below are stored (leave blank if classical)",
      "required": false,
      "type": "event-list"
    },
    {
      "key": "main-config-form-name",
      "name": "<b>Main Config Form Name</b><br>Name of form where config fields are stored",
      "required": false,
      "type": "form-list"
    },
    {
      "key": "participant-config-id-field",
      "name": "<b>Participant Config ID field</b><br>Field to identify which config applies to the Participant",
      "required": false,
      "type": "field-list"
    },
    {
      "key": "survey_portals",
      "name": "Survey Portal Configurations",
      "required": false,
      "type": "sub_settings",
      "repeatable": true,
      "sub_settings": [
        {
          "key": "config-description",
          "name": "<b>Description</b><br>Describe this survey portal and provide any links to documentation that may be useful in supporting it in the future",
          "required": false,
          "type": "textarea"
        },

        {
          "key": "config-id",
          "name": "<b>Unique Config ID</b><br>ID to identify this configuration",
          "required": false,
          "type": "text"
        },
        {
          "key": "enable-portal",
          "name": "<b>Enable Portal</b><br>Must be checked for portal to function",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "portal-disabled-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>PORTAL IS NOT ACTIVE</h3></div>",
          "required": false,
          "type": "descriptive",
          "branchingLogic": {
            "field": "enable-portal",
            "value": false
          }
        },
        {
          "key": "participant-settings-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>PARTICIPANT SETTINGS</h3></div>",
          "required": false,
          "type": "descriptive"
        },
        {
          "key": "participant-disabled",
          "name": "<b>Participant Disabled Field</b><br>If specified and the value is '1', the participant will be disabled and will not be able to create any new survey entries.",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "start-date-field",
          "name": "<b>Start Date Field</b><br>This is day 0 when day numbers are enabled",
          "required": false,
          "type": "field-list"
        },

        {
          "key": "personal-hash-field",
          "name": "<b>Personal Hash Field</b><br>This hash encodes the record_id AND the specific config for the survey portal",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "personal-url-field",
          "name": "<b>Personal URL Field</b><br>This url is unique to this portal config and this user",
          "required": false,
          "type": "field-list"
        },

        {
          "key": "email-field",
          "name": "<b>Email Field</b><BR>Field where email is recorded for this participant (to be used for survey invtes/reminders ",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "disable-participant-email-field",
          "name": "<b>Participant Level: Disable Email Invites and Reminders Field</b><br>If set to 1 (calc or text field) then emails will be disabled for this participant.",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "phone-field",
          "name": "<b>Phone Field</b><br>Field where phone is recorded for this participant (to be used for survey invtes/reminders ",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "disable-participant-sms-field",
          "name": "<b>Participant Level:  Disable SMS Invites and Reminders Field</b><br>If set to 1 (calc or text field) then SMS will be disabled for this participant.",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "survey-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>Repeating Survey Configuration</h3></div>",
          "required": false,
          "type": "descriptive"
        },
        {
          "key": "survey-event-name",
          "name": "<b>Survey Event Name</b><br>Name of event where survey instrument is enabled (leave blank if classical)",
          "required": false,
          "type": "event-list"
        },
        {
          "key": "survey-instrument",
          "name": "<b>Name of Survey Instrument</b><br>This instrument must be repeating.  If the four fields below are NOT part of this instrument, then this instrument and the one containing the four fields below must be part of the same repeating event.",
          "required": false,
          "type": "form-list"
        },
        {
          "key": "survey-config-field",
          "name": "<b>Survey Config ID Field</b><br>This TEXT field stores which config was used in cases where you have multiple repeating configurations in a single project",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "survey-day-number-field",
          "name": "<b>Survey Day Number Field</b><br>This TEXT field is the number of days from the Start Date Field defined above for this survey instance",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "survey-date-field",
          "name": "<b>Survey Date Field</b><br>This TEXT field is the date that corresponds to the day number selected in the calendar landing page",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "survey-launch-ts-field",
          "name": "<b>Survey Launch Timestamp</b><br>This TEXT field captures the actual timestamp of survey launch",
          "required": false,
          "type": "field-list"
        },
        {
          "key": "portal-settings-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>ADDITIONAL SURVEY PORTAL SETTINGS</h3></div>",
          "required": false,
          "type": "descriptive"
        },
        {
          "key": "valid-day-number",
          "name": "<b>Valid Days for Responses</b><br><i>e.g.</i> 0-10,15,20 (leave blank to allow any day number)",
          "required": false,
          "type": "text"
        },
        {
          "key": "max-response-per-day",
          "name": "<b>Maximum Survey Responses per Day</b><br>(leave blank for unlimited daily responses)",
          "default": "1",
          "required": true,
          "type": "text"
        },
        {
          "key": "valid-day-lag",
          "name": "<b>Valid Day Lag</b><br>Number of days in the past someone can still enter a response.  0 => Today only (leave blank for any valid day number)",
          "required": false,
          "type": "text"
        },
        {
          "key": "earliest-time-allowed",
          "name": "<b>Earliest Time Allowed</b><br>Earliest allowed hour of the day (0-24) to collect surveys (e.g. 22 for 8PM)  <br>Do not allow responses for 'today' before this time (leave blank for any time)",
          "required": false,
          "type": "text"
        },
        {
          "key": "landing-page-header",
          "name": "<b>Custom Header for Landing Page</b><br>Enter text to display to user on landing page",
          "required": false,
          "type": "rich-text"
        },
        {
          "key": "show-calendar",
          "name": "<b>Show Calendar</b><br>Show the date-picker calendar to allow participants to select dates for responses.  This is required if you want to allow people to enter data for days in the past",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "show-missing-day-buttons",
          "name": "<b>Show Missing Day Buttons</b><br>Show easy links to start response for any valid, incomplete survey dates",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "auto-start-survey",
          "name": "<b>Auto-Start Survey</b><br>When clicking on invitation, start survey without showing landing page.",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "survey-complete-redirect",
          "name": "<b>Survey Complete Redirect</b><br>Select a survey name here if you wish to redirect participants to the portal upon completion of the survey.",
          "required": false,
          "type": "form-list"
        },
        {
          "key": "enable-invitations",
          "name": "<b>Enable Email/Text Invitations</b><br>Enable the sending of survey invitations on valid invitation days.  The invitation contains the config name and the day number encoded in the url.",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "invitation-days",
          "name": "<b>Invitation Days</b><br>Days on which to send invitations (<i>e.g.</i> 0-10,15-20,25).  These days should be a subset of valid day numbers.",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "field": "enable-invitations",
            "value": true
          }
        },
        {
          "key": "invitation-time",
          "name": "<b>Invitation Time</b><br>Hour of the day (0-24) to send invitation (e.g. 18 for 6PM)",
          "required": false,
          "type": "number",
          "branchingLogic": {
            "field": "enable-invitations",
            "value": true
          }
        },
        {
          "key": "invitation-email-text",
          "name": "<b>Invitation Email Text</b><br>You can use piping to customize this message and use the special tag [invitation-url] for the link.  If not supplied, the link will automatically be added to the end of the message",
          "required": false,
          "type": "textarea",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-invitations",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "invitation-email-subject",
          "name": "<b>Invitation Email Subject</b>",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-invitations",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "invitation-email-from",
          "name": "<b>Invitation Email From</b><br>Enter an email address  to use for from field",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-invitations",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "sms-twilio-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>The use of SMS invitations REQUIRES that a separate EM (Twilio Utility) be installed and enabled globally.</h3></div>",
          "required": false,
          "type": "descriptive",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-invitations",
                "value": true
              },
              {
                "field": "phone-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "invitation-sms-text",
          "name": "<b>Invitation SMS Text</b><br>You can use piping to customize this message and use the special tag [invitation-url] for the link.  If not supplied, the link will automatically be added to the end of the message.  Messages over 160 characters may result in multiple text segments.",
          "required": false,
          "type": "textarea",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-invitations",
                "value": true
              },
              {
                "field": "phone-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "survey-reminders-desc",
          "name": "<div class='alert alert-warning'><h3 class='text-center'>SURVEY REMINDER SETTINGS</h3><br>In some studies, rather than sending an invitation each day, subjects learn to submit every day on their own (for example, after dinner using the shortcut on their mobile device).  In these cases, one can use survey reminders to ONLY notify them if they haven't yet submitted a survey for the current day later on in the day.<br>Survey reminders can also be used with survey invitations as a 'reminder' email similar to the REDCap ASI Reminder function.</div>",
          "required": false,
          "type": "descriptive"
        },
        {
          "key": "enable-reminders",
          "name": "<b>Enable Reminders</b><br>Send survey reminders by phone or email if survey has not been completed for a valid day",
          "required": false,
          "type": "checkbox"
        },
        {
          "key": "reminder-time",
          "name": "<b>Invitation Reminder Time</b><br>Hour of the day (0-24) to send reminder (e.g. 22 for 8PM) if the response has not yet been completed for a valid day.",
          "required": false,
          "type": "number",
          "branchingLogic": {
            "field": "enable-reminders",
            "value": true
          }
        },
        {
          "key": "reminder-days",
          "name": "<b>Invitation ReminderDays</b><br>Days on which to send invitation reminders(<i>e.g.</i> 0-10,15-20,25).  This should be a subset of valid days.",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "field": "enable-reminders",
            "value": true
          }
        },
        {
          "key": "reminder-email-text",
          "name": "<b>Reminder Email Text</b><br>You can use piping to customize this message and use the special tag [invitation-url] for the link.  If not supplied, the link will automatically be added to the end of the message",
          "required": false,
          "type": "textarea",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-reminders",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "reminder-email-subject",
          "name": "<b>Reminder Email Subject</b>",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-reminders",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "reminder-email-from",
          "name": "<b>Reminder Email From</b><br>Enter an email address  to use for from field",
          "required": false,
          "type": "text",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-reminders",
                "value": true
              },
              {
                "field": "email-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        },
        {
          "key": "reminder-sms-text",
          "name": "<b>Reminder SMS Text</b><br>You can use piping to customize this message and use the special tag [invitation-url] for the link.  If not supplied, the link will automatically be added to the end of the message",
          "required": false,
          "type": "textarea",
          "branchingLogic": {
            "conditions": [
              {
                "field": "enable-reminders",
                "value": true
              },
              {
                "field": "phone-field",
                "op": "<>",
                "value": ""
              }
            ]
          }
        }
      ]
    }
  ]
}
